<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calculateur de coût de recette</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
  <style>
    .input-small { width: 60px; }
    .input-medium { width: 120px; }
    .input-large { width: 180px; }
    #recipeDetailsTable td input {
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>Calcul du coût d'une recette</h1>
  <div>
    <label for="recipe-name">Nom de la recette :</label>
    <input type="text" id="recipe-name" class="input-large">
  </div>
  <table id="recipeDetailsTable" class="display">
    <thead>
      <tr>
        <th>Nom de l'ingrédient</th>
        <th>Quantité Achetée</th>
        <th>Unité Achat</th>
        <th>Coût des Marchandises ($)</th>
        <th>Quantité Utilisée</th>
        <th>Unité Utilisée</th>
        <th>Coût Total ($)</th>
      </tr>
    </thead>
    <tbody>
      <!-- Les lignes seront ajoutées ici -->
    </tbody>
  </table>
  <button id="add-ingredient-button">Ajouter un ingrédient</button>
  <div>
    <p>Coût total du lot : <span id="total-batch-cost">0.00</span></p>
    <p>Prix de vente par portion : <input type="text" id="selling-price-per-serve" class="input-medium"></p>
  </div>
  <button id="calculate-button">Calculer le coût</button>
  <script>
    $(document).ready(function() {
      var table = $('#recipeDetailsTable').DataTable();
      // Ajouter un ingrédient vide au tableau
      $('#add-ingredient-button').on('click', function () {
        table.row.add([
          '<input type="text" class="ingredient-name input-large">',
          '<input type="number" class="qty-purchased input-small">',
          '<input type="text" class="unit-purchased input-small">',
          '<input type="number" class="cost-goods input-small">',
          '<input type="number" class="qty-used input-small">',
          '<input type="text" class="unit-used input-small">',
          '<input type="text" class="cost-total input-small" readonly>'
        ]).draw();
      });
      // Calculer le coût
      $('#calculate-button').on('click', function () {
        var totalBatchCost = 0;
        table.rows().every(function () {
          var data = this.data();
          var qtyPurchased = parseFloat($(data[1]).find('input').val()) || 0;
          var costGoods = parseFloat($(data[3]).find('input').val()) || 0;
          var qtyUsed = parseFloat($(data[4]).find('input').val()) || 0;
          var costTotal = (costGoods / qtyPurchased) * qtyUsed;
          $(data[6]).find('input').val(costTotal.toFixed(2));
          totalBatchCost += costTotal;
        });
        $('#total-batch-cost').text(totalBatchCost.toFixed(2));
      });
    });
  </script>
</body>
</html>
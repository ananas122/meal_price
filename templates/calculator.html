<!DOCTYPE html>
<html>
<head>
  <title>Calculator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Inclure les liens vers les fichiers CSS de la barre latérale et des ingrédients -->
  <link rel="stylesheet" href="static/css/dashboard.css">

  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
  <h2>Calculator</h2>

  <div id="sidebar">
    <!-- Contenu de la barre latérale depuis dashboard.css -->
  </div>
  <div id="content-container">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
}

.container {
    max-width: 300px;
    margin: 50px auto;
    padding: 20px;
    background-color: #fff;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border-radius: 5px;
}

input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    box-sizing: border-box;
}

button {
    width: 100%;
    padding: 10px;
    background-color: red;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #0056b3;
}

p {
    margin-top: 20px;
}

#resultat span {
    font-weight: bold;
}
</style>
 <h1>Calcul du prix d'une recette</h1>
  <label for="recipe-select">Sélectionnez une recette :</label>
  <select id="recipe-select">
    <!-- Les options de recettes seront ajoutées dynamiquement via l'API -->
  </select>
  <button id="create-recipe-button">Créer une nouvelle recette</button>
  <h2>Ingrédients</h2>
    <button id="add-ingredient-button">Ajouter un ingrédient</button>

  <table id="recipeDetailsTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Nom de l'ingrédient</th>
        <th>Quantité utilisée</th>
        <th>Unité de mesure</th>
        <th>Coût des marchandises</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <h2>Prix total de la recette :</h2>
  <input type="text" id="total-price" readonly>
  <button id="calculate-button">Calculer le prix</button>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
  <script>
    // Fonction pour mettre à jour la table avec les détails d'une recette
    async function updateTableWithRecipe(recipeId) {
      const table = $('#recipeDetailsTable').DataTable();
      table.clear(); // Nettoyer la table pour les nouvelles données
      try {
        const response = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${recipeId}`);
        const data = await response.json();
        if (data.meals) {
          const meal = data.meals[0]; // Prendre le premier résultat
          // Supposons que les ingrédients et les mesures sont dans des champs séparés comme `strIngredient1` et `strMeasure1`
          for (let i = 1; i <= 20; i++) { // TheMealDB a jusqu'à 20 ingrédients
            if (meal[`strIngredient${i}`]) { // Si l'ingrédient existe
              table.row.add([
                `<input type="text" class="ingredient-input" value="${meal[`strIngredient${i}`]}">`, // Champ de saisie pour le nom de l'ingrédient
                `<input type="text" class="quantity-input" value="${meal[`strMeasure${i}`]}">`, // Champ de saisie pour la quantité
                `<input type="text" class="unit-input" value="unité">`, // Champ de saisie pour l'unité de mesure
                `<input type="text" class="cost-input" value="0.00">` // Champ de saisie pour le coût des marchandises
              ]).draw(false);
            }
          }
        }
      } catch (error) {
        console.error("Erreur lors de la récupération des détails de la recette: ", error);
      }
    }

    // Fonction pour créer une nouvelle recette
    function createNewRecipe() {
      const table = $('#recipeDetailsTable').DataTable();
      table.clear().draw();
      table.row.add([
        '<input type="text" class="ingredient-input">', // Champ de saisie pour le nom de l'ingrédient
        '<input type="text" class="quantity-input">', // Champ de saisie pour la quantité
        '<input type="text" class="unit-input">', // Champ de saisie pour l'unité de mesure
        '<input type="text" class="cost-input">' // Champ de saisie pour le coût des marchandises
      ]).draw(false);
    }

    // Fonction pour récupérer la liste des recettes depuis l'API
    async function getRecipeList() {
      try {
        const response = await fetch('https://www.themealdb.com/api/json/v1/1/search.php?f=c');
        const data = await response.json();
        return data.meals;
      } catch (error) {
        console.error("Erreur lors de la récupération de la liste des recettes: ", error);
        return [];
      }
    }

    // Fonction pour afficher la liste des recettes dans la liste déroulante
    function displayRecipeList(recipes) {
      const recipeSelect = document.getElementById('recipe-select');
      recipes.forEach(recipe => {
        const option = document.createElement('option');
        option.value = recipe.idMeal;
        option.text = recipe.strMeal;
        recipeSelect.add(option);
      });
    }

    // Fonction pour calculer le prix total de la recette
    function calculateTotalPrice() {
      const table = $('#recipeDetailsTable').DataTable();
      const rows = table.rows().data();
      let totalPrice = 0;
      rows.each(row => {
        const quantity = parseFloat(row[1]);
        const cost = parseFloat(row[3]);
        totalPrice += quantity * cost;
      });
      $('#total-price').val(totalPrice.toFixed(2));
    }

    function addIngredient() {
      const table = $('#recipeDetailsTable').DataTable();
      table.row.add([
        '<input type="text" class="ingredient-input">', // Champ de saisie pour le nom de l'ingrédient
        '<input type="text" class="quantity-input">', // Champ de saisie pour la quantité
        '<input type="text" class="unit-input">', // Champ de saisie pour l'unité de mesure
        '<input type="text" class="cost-input">' // Champ de saisie pour le coût des marchandises
      ]).draw(false);
    }
    
    $(document).ready(async function() {
      const recipeSelect = document.getElementById('recipe-select');
      const createRecipeButton = document.getElementById('create-recipe-button');
      const recipes = await getRecipeList();
      displayRecipeList(recipes);
    
    $('#add-ingredient-button').click(addIngredient);

      // Événement lors de la sélection d'une recette
      recipeSelect.addEventListener('change', async function() {
        const recipeId = recipeSelect.value;
        updateTableWithRecipe(recipeId);
      });

      // Événement lors du clic sur le bouton "Créer une nouvelle recette"
      createRecipeButton.addEventListener('click', createNewRecipe);

      // Initialisation de la table DataTable
      $('#recipeDetailsTable').DataTable();

// Événement lors du clic sur le bouton "Calculer le prix"
      $('#calculate-button').click(calculateTotalPrice);
    });
  </script>
</body>
</html>
